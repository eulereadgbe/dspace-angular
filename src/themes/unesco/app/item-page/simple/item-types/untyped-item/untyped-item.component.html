<ds-results-back-button *ngIf="showBackButton$ | async" [back]="back"></ds-results-back-button>
<div class="row" *ngIf="iiifEnabled">
  <div class="col-12">
    <ds-mirador-viewer id="iiif-viewer"
                   [object]="object"
                   [searchable]="iiifSearchEnabled"
                   [query]="iiifQuery$ | async">
    </ds-mirador-viewer>
  </div>
</div>

<div class="d-flex flex-row">
  <ds-item-page-title-field [item]="object" class="mr-auto">
  </ds-item-page-title-field>
  <ds-dso-edit-menu></ds-dso-edit-menu>
</div>
<div class="row">
  <div class="col-xs-12 col-md-4">
    <ng-container *ngIf="!(mediaViewer.image || mediaViewer.video)">
      <ds-metadata-field-wrapper [hideIfNoTextContent]="false">
        <ds-thumbnail [thumbnail]="object?.thumbnail | async"></ds-thumbnail>
      </ds-metadata-field-wrapper>
    </ng-container>
    <div *ngIf="mediaViewer.image || mediaViewer.video" class="mb-2">
      <ds-media-viewer [item]="object"></ds-media-viewer>
    </div>
    <!-- Show dc.relation.uri if it exists -->
    <ng-container *ngIf="hasRelationUri(); else showOriginalFiles">
      <div class="item-page-field" style="margin-bottom: 15px;" *ngFor="let url of object.metadata['dc.relation.uri'] | keyvalue">
        <div class="simple-view-element">
          <h2 class="simple-view-element-header" style="font-size: 1.25rem;">
            {{"item.page.external-url" | translate}}
          </h2>
          <div class="simple-view-element-body">
        <span class="tooltip-wrapper">
          <a href="#" class="btn btn-link p-0 dont-break-out" (click)="openModal(externalLinkModal, url.value.value); $event.preventDefault();">
            {{ parseUrl(url.value.value) }}
          </a>
          <span class="tooltip-text small">External link to view/download this item</span>
        </span>
          </div>
        </div>
      </div>
    </ng-container>
    <!-- Fallback: show original uploaded files -->
    <ng-template #showOriginalFiles>
      <ds-item-page-file-section [item]="object"></ds-item-page-file-section>
    </ng-template>
    <ds-item-page-date-field [item]="object"></ds-item-page-date-field>
    <ds-metadata-representation-list class="ds-item-page-mixed-author-field"
      [parentItem]="object"
      [itemType]="'Person'"
      [metadataFields]="['dc.contributor.author', 'dc.creator']"
      [label]="'relationships.isAuthorOf' | translate">
    </ds-metadata-representation-list>
    <ds-generic-item-page-field [item]="object"
      [fields]="['journal.title']"
      [label]="'item.page.journal-title'">
    </ds-generic-item-page-field>
    <ds-generic-item-page-field [item]="object"
      [fields]="['journal.identifier.issn']"
      [label]="'item.page.journal-issn'">
    </ds-generic-item-page-field>
    <ds-generic-item-page-field [item]="object"
      [fields]="['journalvolume.identifier.name']"
      [label]="'item.page.volume-title'">
    </ds-generic-item-page-field>
    <ds-generic-item-page-field [item]="object"
      [fields]="['dc.publisher']"
      [label]="'item.page.publisher'">
    </ds-generic-item-page-field>
    <div class="item-page-field">
      <ds-metadata-field-wrapper [hideIfNoTextContent]="false">
        <div class="simple-view-element">
          <div class="simple-view-element-body">
            <ds-item-page-dimensions-field [item]="object"></ds-item-page-dimensions-field>
            <ds-item-page-altmetric-field [item]="object"></ds-item-page-altmetric-field>
          </div>
        </div>
      </ds-metadata-field-wrapper>
    </div>
  </div>
  <div class="col-xs-12 col-md-6">
      <ds-item-page-share-field [item]="object">
      </ds-item-page-share-field>
    <ds-item-page-abstract-field [item]="object"></ds-item-page-abstract-field>
    <ds-generic-item-page-field [item]="object"
      [fields]="['dc.description']"
      [label]="'item.page.description'"
      [enableMarkdown]="true">
    </ds-generic-item-page-field>

    <ds-generic-item-page-field [item]="object"
      [fields]="['local.subject']"
      [separator]="'; '"
      [label]="'item.page.subject.local'">
    </ds-generic-item-page-field>
    <ds-item-page-metadata-search-link [item]="object"
      [fields]="['dc.subject']"
      [separator]="'; '"
      [label]="'item.page.subject'"
      [index]="'subject'">
    </ds-item-page-metadata-search-link>
    <ds-item-page-metadata-search-link [item]="object"
      [fields]="['dc.subject.agrovoc']"
      [separator]="'; '"
      [label]="'item.page.subject.agrovoc'"
      [index]="'agrovoc'">
    </ds-item-page-metadata-search-link>
    <ds-item-page-metadata-search-link [item]="object"
      [fields]="['local.subject.scientificname']"
      [separator]="'; '"
      [label]="'item.page.subject.scientificname'"
      [index]="'scientificname'">
    </ds-item-page-metadata-search-link>
    <ds-item-page-metadata-search-link [item]="object"
      [fields]="['dc.coverage.spatial']"
      [separator]="'; '"
      [label]="'item.page.coverage.spatial'"
      [index]="'geographicname'">
    </ds-item-page-metadata-search-link>
    <ds-generic-item-page-field [item]="object"
      [fields]="['dc.subject.lcsh']"
      [separator]="'; '"
      [label]="'item.page.subject.lcsh'">
    </ds-generic-item-page-field>
    <ds-item-page-sdg-field
      [item]="object"
      [fields]="['dc.subject.sdg']"
      [label]="'item.page.sdg'">
    </ds-item-page-sdg-field>
    <ds-item-page-odc-field
      [item]="object"
      [fields]="['dc.subject.odc']"
      [label]="'item.page.odc'">
    </ds-item-page-odc-field>
    <ds-generic-item-page-field [item]="object"
      [fields]="['dc.identifier.citation']"
      [label]="'item.page.citation'"
      [enableMarkdown]="true">
    </ds-generic-item-page-field>
    <ds-item-page-uri-field [item]="object"
      [fields]="['dc.identifier.uri']"
      [label]="'item.page.uri'">
    </ds-item-page-uri-field>
    <div class="item-page-field" style="margin-bottom: 15px;" *ngFor="let doi of object.metadata['dc.identifier.doi']|keyvalue">
      <div class="simple-view-element">
        <h2 class="simple-view-element-header" style="font-size: 1.25rem;">{{"item.page.doi" | translate}}</h2>
        <div class="simple-view-element-body">
          <a class="dont-break-out" href="https://doi.org/{{doi.value.value}}" target="_blank">{{doi.value.value}}</a>
        </div>
      </div>
    </div>
    <ds-item-page-collections [item]="object"></ds-item-page-collections>
    <ds-item-page-uri-field [item]="object"
      [fields]="['coar.notify.endorsedBy']"
      [label]="'item.page.endorsement'">
    </ds-item-page-uri-field>
    <ds-item-page-uri-field [item]="object"
      [fields]="['datacite.relation.isReviewedBy']"
      [label]="'item.page.review'">
    </ds-item-page-uri-field>
    <ds-item-page-uri-field [item]="object"
      [fields]="['datacite.relation.isSupplementedBy']"
      [label]="'item.page.supplemented'">
    </ds-item-page-uri-field>
    <ds-item-page-uri-field [item]="object"
      [fields]="['datacite.relation.isReferencedBy']"
      [label]="'item.page.referenced'">
    </ds-item-page-uri-field>
    <ds-item-page-cc-license-field [item]="object" [variant]="'full'">
    </ds-item-page-cc-license-field>
    <div>
      <a class="btn btn-outline-primary" [routerLink]="[itemPageRoute + '/full']" role="button">
        <i class="fas fa-info-circle"></i> {{"item.page.link.full" | translate}}
      </a>
    </div>
  </div>
</div>
<!-- Bootstrap-styled modal -->
<ng-template #externalLinkModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">EXTERNAL LINKS DISCLAIMER</h5>
    <button type="button" class="btn btn-secondary" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p>
      This link is being provided as a convenience and for informational purposes only. UNACOM bears no
      responsibility for the accuracy, legality or content of the external site or for that of subsequent links.
      Contact the external site for answers to questions regarding its content.
    </p>
    <p>
      If you come across any external links that don't work, we would be grateful if you could report them to the
      repository administrators.
    </p>
    <p>
      Click <b>DOWNLOAD</b> to open/view the file.
      <a routerLink="/info/feedback" (click)="modal.close('Feedback link')">{{ 'footer.link.feedback' | translate}}</a>
      in case the link we provided doesn't work.
    </p>
  </div>
  <div class="modal-footer d-flex justify-content-between">
    <a class="btn btn-primary" [href]="modalUrl" target="_blank" (click)="modal.close('Download click')">DOWNLOAD</a>
    <button class="btn btn-secondary" (click)="modal.close('Close click')">CLOSE</button>
  </div>
</ng-template>
